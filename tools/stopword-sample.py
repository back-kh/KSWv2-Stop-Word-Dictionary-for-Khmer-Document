
import csv
import re

# --- Optional Dependency Handling ---
try:
    from khmernltk import pos_tag as khmernltk_pos_tag
    KHMERNLTK_AVAILABLE = True
except ImportError:
    KHMERNLTK_AVAILABLE = False

try:
    import pytesseract
    from PIL import Image
    OCR_AVAILABLE = True
except ImportError:
    OCR_AVAILABLE = False

# --- Built-in Dictionary for Segmentation ---
def get_khmer_dictionary():
    """
    Returns a larger, built-in dictionary of common Khmer words for better segmentation.
    This improves the accuracy of khseg() and khfilter().
    """
    return {
        'ស្ថិតនៅ', 'ក្នុង', 'ខេត្ត', 'សៀមរាប', 'ប្រទេស', 'កម្ពុជា', 'សាលារៀន', 'សួស្តី', 
        'ខ្ញុំ', 'ស្រឡាញ់', 'ភាសាខ្មែរ', 'នេះ', 'គឺ', 'ជា', 'ស្ថិត', 'នៅ', 'វត្ត', 'បុរាណ', 
        'មាន', 'ព្រះវិហារ', 'ធំ', 'បំផុត', 'ពេល', 'សម្រាក', 'ព្រឹក', 'មនុស្ស', 'ច្រើន', 'កូន', 
        'សិស្ស', 'គ្រូ', 'បង្រៀន', 'សៀវភៅ', 'ប៊ិក', 'ខ្មៅដៃ', 'សាលា', 'រៀន', 'ទៅ', 'មក', 
        'ញ៉ាំ', 'បាយ', 'ទឹក', 'ដោះគោ', 'ឆ្ងាញ់', 'ផ្ទះ', 'ឡាន', 'ម៉ូតូ', 'កង់', 'ដើរ', 'រត់', 
        'លេង', 'ទាត់', 'បាល់', 'មិត្តភ័ក្តិ', 'ឪពុក', 'ម្តាយ', 'បង', 'ប្អូន', 'ប្រុស', 'ស្រី', 
        'លោកគ្រូ', 'អ្នកគ្រូ', 'មន្ទីរពេទ្យ', 'ឈឺ', 'ពេទ្យ', 'ថ្នាំ', 'ព្យាបាល', 'ជាសះស្បើយ', 
        'ទីផ្សារ', 'ទិញ', 'លក់', 'អីវ៉ាន់', 'បន្លែ', 'ផ្លែឈើ', 'សាច់', 'ត្រី', 'លុយ', 'កាក់', 
        'កុំព្យូទ័រ', 'ទូរស័ព្ទ', 'កម្មវិធី', 'អ៊ីនធឺណិត', 'គេហទំព័រ', 'សរសេរ', 'អាន', 'និយាយ', 
        'ស្តាប់', 'មើល', 'ទូរទស្សន៍', 'កុន', 'ចម្រៀង', 'ពិរោះ', 'ស្អាត', 'ល្អ', 'អាក្រក់', 
        'ខ្ពស់', 'ទាប', 'វែង', 'ខ្លី', 'ធំ', 'តូច', 'ថ្មី', 'ចាស់', 'ក្តៅ', 'ត្រជាក់', 'ថ្ងៃ', 
        'ខែ', 'ឆ្នាំ', 'ម៉ោង', 'នាទី', 'វិនាទី', 'ម្សិលមិញ', 'ថ្ងៃនេះ', 'ស្អែក', 'ព្រះអាទិត្យ', 
        'ព្រះចន្ទ', 'ផ្កាយ', 'មេឃ', 'ដី', 'ភ្នំ', 'សមុទ្រ', 'ទន្លេ', 'បឹង', 'ព្រៃ', 'ឈើ', 'ផ្កា', 
        'ក្រហម', 'ខៀវ', 'បៃតង', 'លឿង', 'ស', 'ខ្មៅ', 'ពណ៌', 'សំលៀកបំពាក់', 'អាវ', 'ខោ', 
        'ស្បែកជើង', 'មួក', 'វ៉ែនតា', 'ឆ្កែ', 'ឆ្មា', 'មាន់', 'ទា', 'គោ', 'ជ្រូក', 'ដំរី', 
        'ខ្លា', 'តោ', 'ស្វា', 'ពស់', 'ត្រី', 'សត្វ', 'ធ្វើការ', 'ក្រុមហ៊ុន', 'បុគ្គលិក', 
        'ចៅហ្វាយ', 'លិខិត', 'របាយការណ៍', 'ប្រជុំ', 'សំខាន់', 'គម្រោង', 'ជោគជ័យ', 'បរាជ័យ', 
        'ព្យាយាម', 'ឧស្សាហ៍', 'ខ្ជិល', 'ពូកែ', 'ខ្សោយ', 'ចំណេះដឹង', 'វិទ្យាសាស្ត្រ', 
        'គណិតវិទ្យា', 'ប្រវត្តិសាស្ត្រ', 'ភូមិសាស្ត្រ', 'សិល្បៈ', 'តន្ត្រី', 'កីឡា', 'សុខភាព', 
        'អាហារ', 'ភេសជ្ជៈ', 'ដំណេក', 'ភ្ញាក់', 'ដើរលេង', 'ដំណើរកម្សាន្ត', 'យន្តហោះ', 
        'កប៉ាល់', 'រថភ្លើង', 'ផ្លូវ', 'ស្ពាន', 'អគារ', 'ភូមិ', 'ឃុំ', 'ស្រុក', 'ខេត្ត', 'រាជធានី', 
        'ពិភពលោក', 'គ្រួសារ', 'សង្គម', 'រដ្ឋាភិបាល', 'នយោបាយ', 'សេដ្ឋកិច្ច', 'វប្បធម៌', 
        'ប្រពៃណី', 'ជំនឿ', 'សាសនា', 'ស្នេហា', 'មិត្តភាព', 'ក្តីសង្ឃឹម', 'ក្តីសុខ', 'ទុក្ខ', 
        'សប្បាយ', 'រីករាយ', 'កើតទុក្ខ', 'ខឹង', 'ខ្លាច', 'ភ្ញាក់ផ្អើល', 'ស្រស់ស្អាត', 'អស្ចារ្យ'
    }